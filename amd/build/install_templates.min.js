define(["jquery","core/config","core/str","core/modal_factory","core/modal_events"],function(a,b,c,d){return{init:function(){var d=function(){a(".template_section").change(function(){var b=a(this).find("input").is(":checked"),d=a(this).attr("sectionid");if(a('.template_module[sid = "'+d+'"]').prop("checked",b),0!==a("input:checked").length){a("input.template_module").attr("disabled",""),a("#target_topic_btn").removeClass("disabled");var e=c.get_string("select_section_after","block_modlib");a.when(e).done(function(b){a("#target_topic_btn").html(b)});var e=c.get_string("select_section_after_mouseover","block_modlib");a.when(e).done(function(b){a("#target_topic_btn").attr("title",b)})}else{a("input.template_module").removeAttr("disabled"),a("#target_topic_btn").addClass("disabled");var e=c.get_string("select_section","block_modlib");a.when(e).done(function(b){a("#target_topic_btn").html(b)});var e=c.get_string("select_section_mouseover","block_modlib");a.when(e).done(function(b){a("#target_topic_btn").attr("title",b)})}}),a(".module_row").on("click",function(){0!==a("input:checked").length?a("#target_topic_btn").removeClass("disabled"):a("#target_topic_btn").addClass("disabled")})},e=function(b){var c=[];a('input[class="template_module"]:checked').each(function(){var d={};d.sectionid=b,d.cmid=a(this).attr("cmid"),d.name=a(this).attr("name"),d.type=a(this).attr("module_type"),c.push(d)});var d={};d.sectionid=b,d.type="modules",d.payload=c,h(d)},f=function(b){var c=[];a('input[class="template_section"]:checked').each(function(){var b={};b.id=a(this).attr("sid"),b.name=a(this).attr("name"),c.push(b)});var d={};d.sectionid=b,d.type="sections",d.payload=c,h(d)},g=function(){a(".modlib-sections .dropdown-item").on("click",function(){a(".modlib-modal").show(),0===a('input[class="template_section"]:checked').length?e(a(this).attr("value")):f(a(this).attr("value"))})},h=function(c){var d=b.wwwroot+"/blocks/modlib/ajax/install_templates.php";a.ajax({url:d,type:"POST",data:{sectionid:c.sectionid,type:c.type,payload:c.payload},success:function(b){a("#modlib-modal-msg").html(b),location.reload()},error:function(b){a(".modlib-modal").hide(),console.error(b)}})},i=function(){d(),g()};a(document).ready(function(){i(),a("#modlib-spinner-modal").hide(),a("tr.module").css("cursor","pointer")})}}});