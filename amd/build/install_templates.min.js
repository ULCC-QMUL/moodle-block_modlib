define(["jquery","core/config","core/str","core/modal_factory","core/modal_events"],function(a,b,c){return{init:function(){var d=function(){a(".template_section").change(function(){var b=a(this).find("input").is(":checked"),d=a(this).attr("sectionid");a('.template_module[sid = "'+d+'"]').prop("checked",b);var e="";0!==a("input.template_section:checked").length?(a("input.template_module:checked:not([disabled])").prop("checked",!1),a('.template_module[sid = "'+d+'"]').prop("checked",b),a("input.template_module").attr("disabled",""),console.log("module selection disabled"),a("#target_topic_btn").removeClass("disabled"),console.log("target button enabled"),e=c.get_string("select_section_after","block_modlib"),a.when(e).done(function(b){a("#target_topic_btn").html(b),console.log('button text set to "'+b+'"')}),e=c.get_string("select_section_after_mouseover","block_modlib"),a.when(e).done(function(b){a("#target_topic_btn").attr("title",b)})):(a("input.template_module").removeAttr("disabled"),console.log("module selection no longer disabled"),a("#target_topic_btn").addClass("disabled"),console.log("target button disabled"),e=c.get_string("select_section","block_modlib"),a.when(e).done(function(b){a("#target_topic_btn").html(b),console.log('button text set to "'+b+'"')}),e=c.get_string("select_section_mouseover","block_modlib"),a.when(e).done(function(b){a("#target_topic_btn").attr("title",b)}))}),a(".module_row").on("click",function(){0!==a("input.template_module:checked").length?a("#target_topic_btn").removeClass("disabled"):a("#target_topic_btn").addClass("disabled")})},e=function(b){var c=[];a("input.template_module:checked").each(function(){var d={};d.sectionid=b,d.cmid=a(this).attr("cmid"),d.name=a(this).attr("name"),d.type=a(this).attr("module_type"),c.push(d)});var d={};d.sectionid=b,d.type="modules",d.payload=c,h(d)},f=function(b){var c=[];a("input.template_section:checked").each(function(){var b={};b.id=a(this).attr("sid"),b.name=a(this).attr("name"),c.push(b)});var d={};d.sectionid=b,d.type="sections",d.payload=c,h(d)},g=function(){a(".modlib-sections .dropdown-item").on("click",function(){a(".modlib-modal").show(),0===a('input[class="template_section"]:checked').length?e(a(this).attr("value")):f(a(this).attr("value"))})},h=function(c){var d=b.wwwroot+"/blocks/modlib/ajax/install_templates.php";a.ajax({url:d,type:"POST",data:{sectionid:c.sectionid,type:c.type,payload:c.payload},success:function(b){a("#modlib-modal-msg").html(b),window.location=window.location,location.reload()},error:function(){a(".modlib-modal").hide()}})},i=function(){d(),g()};a(document).ready(function(){i(),a("#modlib-spinner-modal").hide(),a("tr.module").css("cursor","pointer")})}}});