define(["jquery","core/config","core/str","core/modal_factory","core/modal_events"],function(a,b,c,d){return{init:function(){var c=function(){a(".template_section").change(function(){var b=a(this).find("input").is(":checked"),c=a(this).attr("sectionid");a('.template_module[sid = "'+c+'"]').prop("checked",b),0!==a("input:checked").length?(a("#target_topic_btn").hide(),a("#after_topic_btn").show(),a("#after_topic_btn").removeClass("disabled"),a("input.template_module").attr("disabled","")):(a("#target_topic_btn").show(),a("#after_topic_btn").hide(),a("#after_topic_btn").addClass("disabled"),a("input.template_module").removeAttr("disabled"))}),a(".module_row").on("click",function(){0!==a("input:checked").length?a("#target_topic_btn").removeClass("disabled"):a("#target_topic_btn").addClass("disabled")})},e=function(){a(".modlib-sections .dropdown-item").on("click",function(){if(0===a('input[class="template_module"]:checked').length)d.create({type:d.types.CANCEL,title:"No Module selected",body:"Please select at least one module to install."}).then(function(a){a.show()});else{a(".modlib-modal").show();var c=a(this).attr("value"),e=a('input[class="template_module"]:checked').length;a('input[class="template_module"]:checked').each(function(){var d={};d.id=a(this).val(),d.cmid=a(this).attr("cmid"),d.name=a(this).attr("name"),d.type=a(this).attr("module_type");var f=b.wwwroot+"/blocks/modlib/execute.php";a.ajax({url:f,type:"POST",data:{sectionid:c,cmid:d.cmid,moduleid:d.id,type:d.type},success:function(b){a("#modlib-modal-msg").html(b),--e||location.reload()},error:function(b){a(".modlib-modal").hide(),console.error(b)}})})}})},f=function(){a(".modlib-sections .dropdown-item").on("click",function(){if(0===a('input[class="template_section"]:checked').length)e();else{a(".modlib-modal").show();var c=a(this).attr("value"),d=a('input[class="template_section"]:checked').length;a('input[class="template_section"]:checked').each(function(){var e={};e.id=a(this).attr("sid"),e.name=a(this).attr("name");var f=b.wwwroot+"/blocks/modlib/execute.php";a.ajax({url:f,type:"POST",data:{sectionid:c,cmid:e.id,type:"section"},success:function(b){a("#modlib-modal-msg").html(b),--d||location.reload()},error:function(b){a(".modlib-modal").hide(),console.error(b)}})})}})},g=function(){c(),f()};a(document).ready(function(){g(),a("#modlib-spinner-modal").hide(),a("tr.module").css("cursor","pointer")})}}});