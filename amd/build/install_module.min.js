define(["jquery","core/config","core/str","core/modal_factory","core/modal_events"],function(a,b,c,d){return{init:function(){var d=function(){a(".template_section").change(function(){var b=a(this).find("input").is(":checked"),d=a(this).attr("sectionid");if(a('.template_module[sid = "'+d+'"]').prop("checked",b),0!==a("input:checked").length){a("input.template_module").attr("disabled",""),a("#target_topic_btn").removeClass("disabled");var e=c.get_string("select_section_after","block_modlib");a.when(e).done(function(b){a("#target_topic_btn").html(b)})}else{a("input.template_module").removeAttr("disabled"),a("#target_topic_btn").addClass("disabled");var e=c.get_string("select_section","block_modlib");a.when(e).done(function(b){a("#target_topic_btn").html(b)})}}),a(".module_row").on("click",function(){0!==a("input:checked").length?a("#target_topic_btn").removeClass("disabled"):a("#target_topic_btn").addClass("disabled")})},e=function(b){a('input[class="template_module"]:checked').each(function(){var c={};c.sectionid=b,c.cmid=a(this).attr("cmid"),c.name=a(this).attr("name"),c.type=a(this).attr("module_type"),h(c)})},f=function(b){a('input[class="template_section"]:checked').each(function(){var c={};c.id=a(this).attr("sid"),c.name=a(this).attr("name");var d={};d.sectionid=b,d.cmid=c.id,d.type="section",h(d)})},g=function(){a(".modlib-sections .dropdown-item").on("click",function(){a(".modlib-modal").show(),0===a('input[class="template_section"]:checked').length?e(a(this).attr("value")):f(a(this).attr("value"))})},h=function(c){if("section"==c.type)var d=a('input[class="template_section"]:checked').length;else var d=a('input[class="template_module"]:checked').length;var e=b.wwwroot+"/blocks/modlib/execute.php";a.ajax({url:e,type:"POST",data:{sectionid:c.sectionid,cmid:c.cmid,type:c.type},success:function(b){a("#modlib-modal-msg").html(b),--d||location.reload()},error:function(b){a(".modlib-modal").hide(),console.error(b)}})},i=function(){d(),g()};a(document).ready(function(){i(),a("#modlib-spinner-modal").hide(),a("tr.module").css("cursor","pointer")})}}});