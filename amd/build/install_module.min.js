define(["jquery","core/str","core/modal_factory","core/modal_events"],function(a,b,c,d){return{init:function(){var b=function(){a(".modlib-sections .dropdown-item").on("click",function(){if(0===a('input[class="module"]:checked').length)c.create({type:c.types.CANCEL,title:"No Module selected",body:"Please select at least one module to install."}).then(function(a){a.show()});else{a(".modlib-modal").show();var b=a(this).attr("value"),d=a('input[class="module"]:checked').length;a('input[class="module"]:checked').each(function(){var c={};c.id=a(this).val(),c.cmid=a(this).attr("cmid"),c.name=a(this).attr("name"),c.type=a(this).attr("module_type");var e=window.location.pathname,f=e.split("/");f.shift();var g=window.location.protocol+"//"+window.location.host+"/"+f.shift()+"/blocks/modlib/execute.php";f=a.ajax({url:g,type:"POST",data:{sectionid:b,cmid:c.cmid,moduleid:c.id,type:c.type},success:function(b){""!==b?a("#modlib-modal-msg").html(b):console.warn("Unsupported module type for installation: "+c.type+"!\n"),--d||(a(".modlib-modal").hide(),location.reload())},error:function(b){a(".modlib-modal").hide(),console.error(b)}})})}})},d=function(){b()};a(document).ready(function(){console.log("=================< modlib/install_module >================="),d(),a(".module_row").on("click",function(){0!==a('input[class="module"]:checked').length?a("#target_topic_btn").removeClass("disabled"):a("#target_topic_btn").addClass("disabled")}),a("#modlib-spinner-modal").hide(),a("tr.module").css("cursor","pointer")})}}});